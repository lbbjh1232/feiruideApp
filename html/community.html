<!DOCTYPE html>
<html>

	<head> 
		<meta charset="utf-8"> 
		<title>通讯录</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta http-equiv="Access-Control-Allow-Origin" content="*">
		<meta http-equiv="content-security-policy">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<script type="text/javascript">
			document.write('<script src="../js/fix.js?rd=?rd=' + Math.random() + '"><\/script>');
		</script>   
		  
		<script type="text/javascript">
			link(['../css/mui.min.css','../css/common.css','../css/icon.css','../css/animate.css','../css/community/index.css'],true);   
		</script>
		
	</head>  
   
	<body>   
		<div class="mui-content" id="app">
			<div id="nav-box">
			
				<div id="nav-tab" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
			    <div class="mui-scroll" style="position: absolute;">
			        <a class="mui-control-item mui-active">
			            最新
			        </a>
			        <a class="mui-control-item">
			            医保政策
			        </a>
			        <a class="mui-control-item">
			            临床医学
			        </a>
			        <a class="mui-control-item">
			            新药新产品
			        </a>
					<a class="mui-control-item">
						短缺求助
					</a>
			        <a class="mui-control-item">
			            行业动态
			        </a>
			        <a class="mui-control-item">
			            其他话题
			        </a>
			    </div>
			</div> 
			 
			</div>     
			    
			<!-- 添加按钮 -->
			<div id="addCommunity" class="com-edit iconfont1 icon-community-edit"></div>
			
			<div class="community-content">
			    
				<!-- 热门动态 -->    
				<div class="hot-topic"> 
					<div class="hot-title-box">  
						<div class="left-hot-title">热门话题</div>  
						<div class="left-hot-more">查看全部 &gt;</div>
					</div>   
					  
					<div class="hot-list-box">
						
						<div class="hot-item-box">
							<div class="hot-cover"><img src="../images/banner1.png" ></div>
							<div class="hot-topic-title">#医保政策#</div>
							<div class="hot-topic-level"><span class="orange">14.5w</span> 讨论</div>
						</div>
						
						<div class="hot-item-box"> 
							<div class="hot-cover"><img src="../images/banner2.png" ></div>
							<div class="hot-topic-title">#临床医学#</div>
							<div class="hot-topic-level"><span class="orange">14.5w</span> 讨论</div>
						</div>
						<div class="hot-item-box">
							<div class="hot-cover"><img src="../images/banner3.png" ></div>
							<div class="hot-topic-title">#短缺求助#</div>
							<div class="hot-topic-level"><span class="orange">14.5w</span> 讨论</div>
						</div>
						<div class="hot-item-box">
							<div class="hot-cover"><img src="../images/banner3.png" ></div>
							<div class="hot-topic-title">#行业动态#</div>
							<div class="hot-topic-level"><span class="orange">14.5w</span> 讨论</div>
						</div>
						
					</div>
					
				</div>
				<div class="divided-line"></div>
				
				<tempalte v-for="(item,index) in result">
					
					<div v-if="item.content.length==1" class="community-item-box">
						<div class="left-title">{{item.title}}</div>
						 
						<div class="right-img"> 
							<img :src="item.content[0].url"/>   
						</div> 
						<div class="bottom-info">
							<div class="username">
								<span>{{item.username}}</span>&nbsp;&nbsp;&nbsp;<span>{{item.scan_number}}阅读</span>
							</div>  
							<div class="creat-time">
								 {{item.show_time}}
							</div> 
						</div>
					</div>  
						  
					<div v-else class="community-item-box">
						<div class="left-title-1">{{item.title}}</div> 
						 
						<div v-show="item.content.length !== 0" class="right-img-1"> 
							<img v-for="items in item.content" :src="items.url"/>
						</div>
						
						<div class="bottom-info">
							<div class="username">
								<span>{{item.username}}</span>&nbsp;&nbsp;&nbsp;<span>{{item.scan_number}}阅读</span>
							</div>
							<div class="creat-time"> 
								{{item.show_time}}
							</div> 
						</div>
					</div>
				</tempalte>
				
				
			</div> 
		</div>
		<script type="text/javascript">
			script(['../js/mui.min.js','../js/vue.js','../js/api.js','../js/app.js']);
		</script>
		
		<script>
			mui.init();
			 
			var vm = new Vue({
				el : '#app',
				data : {
					result:[],
					topic:[],
					currentTopic:0, 	//0:最新动态
					pageIndex :1,
					
				}
			});
			
			function load(){
				let res = mui.http_post(API.COMMUNITY_LOAD,{topic:vm.currentTopic,pageIndex:vm.pageIndex});
				res.then(res=>{
					if(res.code == 200){
						vm.result = res.data;
					}
				})
			}
			   
			mui.plusReady(function () {
				
				load();
				
				//添加动态
				document.getElementById('addCommunity').addEventListener('tap',function(){
					//登录提示
					mui.loginPageShow();
					
					let accountInfo = JSON.parse(plus.storage.getItem('accountInfo'));
					(accountInfo.roleid == 12)?(function(){
						
						mui.openWindow({
							url : '/html/my/auth.html',
							id : 'auth'
						});
						throw error;
						
					})():null;
					
					mui.openWindow({
						url:'community/add-community.html',
						id:'add-community',
						show:{
							aniShow:'slide-in-bottom'
						}
					});
				})
				
			});
			
		</script>
	</body>
</html>