<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>新闻资讯</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<script type="text/javascript">
			document.write('<script src="../../js/fix.js?rd=?rd=' + Math.random() + '"><\/script>');
		</script>
		<script type="text/javascript">
			link(['../../css/mui.min.css','../../css/common.css','../../css/iconfont.css',],true);
		</script>
		<style type="text/css">
			body{
				background-color: #FFFFFF;
			}
			.mui-content{
				margin-top: 1rem;
			}
			
		</style>

	</head>
 
	<body> 
	
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">新闻资讯</h1>
		</header>
		
		<div class="mui-content" id="app">
			
			<template v-for="(item,index) in newsData">
				<div class="news-box" :data-index="index">
					<div class="news-left">
						<div class="news-name">{{item.title}}</div>
						<div class="news-date">{{item.create_time}}</div>
					</div>
					<div class="news-right">
						<img :src="item.cover" onerror="this.src='../../images/60x60.gif'" />
					</div>
				</div>
			</template>
			<div id="">
				
			</div>
			
	
			
		</div>
	</body>
	<script src="../../js/mui.min.js"></script>
	<script src="../../js/vue.js"></script>
	<script src="../../js/api.js"></script>
	<script src="../../js/app.js"></script>
	<script type="text/javascript">
		function getNews(num){
			let news = mui.http_post(API.GET_NEWS,{num : num});
			if(news.code == 200){
				vm.newsData = news.data.data;
				if(news.data.more == 1){
					vm.more = true;
				}else{
					vm.more = false;
				}
			}
		}
		var vm = new Vue({
			el : '#app',
			data : {
				num : 20,
				newsData : [],
				more : true
			}
		})
		mui.init({
			pullRefresh : {
				container:"#app",
				down : {
					style:'circle',
					color:'#3383FC', 
					height:'50px',
					range:'100px', 
					offset:'0px', 
					auto: false,
					callback :function(){
						getNews(20);
						mui('#app').pullRefresh().endPulldown();
						mui('#app').pullRefresh().enablePullupToRefresh();
					} 
			    },
				up:{
				      contentrefresh : "正在加载...",
				      contentnomore:'没有更多数据了',
				      callback :function(){
						  vm.num = parseInt(vm.num) + 20;
						  getNews(vm.num);
						  if(vm.more){
							  this.endPullupToRefresh(false);
						  }else{
							  this.endPullupToRefresh(true);
						  }
					  }
				    }
			}
		});
		
		
		mui.plusReady(function () {
			plus.nativeUI.closeWaiting()
			mui.currentWebview.show()
			getNews(20);
			
			//新闻详情页
			 mui('#app').on('tap','.news-box',function(){
				 let index = this.dataset.index;
				 let news = vm.newsData[index];
				 mui.openWindow({
					 url : 'news-detail.html',
					 id : 'html/news/news-detail.html',
					 show:{
						 autoShow : false
					 },
					 extras : {
						title : news.title,
						conver : news.cover,
						time : news.create_time,
						content : news.content
					 }
				 })
			 })
		})
	</script>
	
</html>